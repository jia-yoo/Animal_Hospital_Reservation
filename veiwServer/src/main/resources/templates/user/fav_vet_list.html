<!DOCTYPE html>
<html class="h-100" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>견강할고양</title>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<link href="/css/style.css" rel="stylesheet">
<link href="/css/myPetList.css" rel="stylesheet">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Do+Hyeon&family=Jua&display=swap" rel="stylesheet">
<style>
	.item{
		margin : 10px;
	}
</style>

</head>
<body class="d-flex flex-column h-100">
<div th:replace="~{user/header :: header}"></div>
<div class="container-xl">


<h1 class="mt-3 mt-md-5 mb-3 mb-md-3">즐겨찾기 리스트</h1>
<hr>
<div class="container text-center">
<div id="favList" class="row row-cols-3"></div>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	  <div class="modal-dialog modal-lg">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
	        <img onclick="checkBookmark(event)" id="bookmarkImg" style="width:40px; display:none;" src="/images/bookmark.png">
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	      </div>
	      <div class="modal-body">
	        <div id="hospital_id" style="display:none;">번호</div>
	        <div class='modal-item'><span class="modal-sub-title">번호</span><span id="phone">번호</span></div>
	        <div class='modal-item'><span class="modal-sub-title">주소</span><span id="address">주소</span></div>
	        <div class='modal-memVetInfo' style="display:none;">
	          <div class='modal-item'><span class="modal-sub-title">영업시간</span><span id="working_hour" style="display:none;">영업시간</span></div>
	          <div class="modal-item img_container" style="display:none;"><img id="logo" src="" style="display:none;" alt="로고"/></div>
	          <div class='modal-item'><img style="width:35px; transform: rotate(-20deg);" src="/images/pin_p.svg"><span class="modal-sub-title">포인트제휴여부</span><span id="point" style="display:none;">포인트제휴여부</span></div>
	          <div class='modal-item'><span class="modal-sub-title">병원소개</span><span id="introduction" style="display:none;">병원소개</span></div>
	          <div class='modal-item'>
	            <span class="modal-sub-title">평균별점</span>
	            <div class="reviewContainer">
	              <div id='review_overview'>
		              <span id="avgReview">평균별점</span>
		              <span id="reviewStars"></span>
		              <span id="reviewCount">리뷰 개수</span>
		              <div id="reviewDistribution">
		                <!-- 리뷰 분포 그래프 -->
		              </div>
	              <a id="toggleReviews" style="display: none;">리뷰 보기</a>
	              </div>
	              <div id="reviewList" style="display: none;">
	                <div id="review"></div>
	              </div>
	            </div>
	          </div>
	          <div class='modal-item'><span class="modal-sub-title">대표자이름</span><span id="representative" style="display:none;">대표자이름</span></div>
	          <div class='modal-item'><span class="modal-sub-title">이메일</span><span id="email" style="display:none;">이메일</span></div>
	          <div class='modal-item'><span class="modal-sub-title">사업자번호</span><span id="businessNumber" style="display:none;">사업자번호</span></div>
	          <div class="row">
	            <div class="col-6 p-1">
	              <button style="display:none; width: 100%;" class="btn btn-user-sub reservationBtn" onclick="makeReservation(event)">예약하기</button>
	            </div>
	            <div class="col-6 p-1">
	              <button style="display:none; width: 100%;" class="btn btn-hospital-sub chatBtn" onclick="chat(event)">문의채팅</button>
	            </div>
	          </div>
	        </div>
	      </div>
	    </div>
	  </div>
	</div>

</div>
<div th:replace="~{user/footer :: footer}"></div>
<script type="text/javascript" src="/js/modal.js"></script>

<script>
ready();
	function ready(){
		const favList = document.querySelector("#favList");
		favList.innerHTML='';
		const xhttp = new XMLHttpRequest();
		xhttp.onload = function() {
			alert(this.responseText);
			const list = JSON.parse(this.responseText);
			list.forEach(vet =>{
				var adds = vet.address.split("//");
				
				
				favList.innerHTML += 
					`<div class="shadow p-3 mb-5 bg-body-tertiary rounded col item" name='item'>
						<div >
							<div name='top'>
							<img onclick="removeBookmark(event)" id="${vet.id}" style="width:40px;" src="/images/bookmark_fill.png">
							<button type="button" onclick="showModal(event)" class="btn btn-hospital-sub" data-bs-toggle="modal" data-bs-target="#exampleModal">${vet.hospital_name}</button>
							</div>
							<div name='address'class="address"><strong>병원주소</strong> : ${adds[0]}  ${adds[1]}<br> ${adds[2]} </div>
						</div>	
					</div>`;
			});
			
			
		}
		xhttp.open("get", "http://localhost:9001/api/v1/user/fav_vet/"+localStorage.getItem("MemberId"));
		//xhttp.setRequestHeader("Content-type", "application/json");
		var token = localStorage.getItem('token');
		if (token) {
			xhttp.setRequestHeader("Authorization",token);
		}
		xhttp.send();
	}
	
	function removeBookmark(e){
		var bookmarkId = e.target.id;
		const xhttp = new XMLHttpRequest();
		xhttp.onload = function() {
			try{
				if(this.status ==200){
					window.location.href="/user/fav_vet_list";
				}
			}
			catch(e){
				console.log(e);
			}
			
			
			
			
		}
		xhttp.open("delete", "http://localhost:9001/api/v1/user/fav_vet/"+bookmarkId);
		//xhttp.setRequestHeader("Content-type", "application/json");
		var token = localStorage.getItem('token');
		if (token) {
			xhttp.setRequestHeader("Authorization",token);
		}
		xhttp.send();
	}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>